<?php
    session_start();
    require_once ('../admin/dataBase.php');
    
    $connexionError="";
    $SuccessConnexion=TRUE;
    if(!empty($_POST))
    {
        
        $Login =VerifInfo($_POST['Login']);
        $Psw  = VerifInfo($_POST['Psw']);
        $Psw =sha1($Psw);
        $SuccessConnexion=VerifUser($Login,$Psw);
        if($SuccessConnexion)
        {
            // $db=DB::connect();
            // $Rid=$db->prepare('SELECT id FROM client WHERE Nom =?');
            // $Rid->execute(array($Login));
            // $ID=$Rid->fetch();
            // $id=$ID['id'];
            $_SESSION['Login']=$Login;
            DB::Desconexte();
            header('Location:../profil.php');
            var_dump($_SESSION);   
        }
        else{
            $connexionError=":( Login ou  Mot de pass invalide !!!!";
        }
        
    }
    function VerifInfo($info){
        $info=trim($info);
        $info=htmlspecialchars($info);
        $info=stripslashes($info);
        return $info;
    }
    function VerifUser($UserLogin,$UserPasseword)
    {
        //connexion a la base de donnee ;
        $db=DB::connect();
        $verif =$db->prepare('SELECT * FROM client WHERE Nom = ?');
        $verif->execute(array($UserLogin));
        $reponce = $verif->fetch(); 
        if($reponce){
            if($reponce['Password']==$UserPasseword){
                return true;
            }
            else{
                return false;
            }
        }
        else{
            return false;
        }
        DB::Desconexte();
    }
    
    

?>



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../css/style.css">
    
</head>
<body>
    <!-- MENU DE NAVIGATION -->
    <header>
        <nav class="navbar navbar-inverse">
            <div class="container">
              <div class="navbar-header">
                <a class="navbar-brand" href="index.php">PentestBanckManager</a>
              </div>
              <ul class="nav navbar-nav navbar-right">
                <li class="active"><a href="singin.php">Cree un compte</a></li>
              </ul>
            </div>
          </nav>
        </header>
    <!-- FIN MENU DE NAVIGATION -->
        <div class="container connexion">
        <h2>Connexion</h2>
        
        <div class="container  col-md-4 ">

            <form id="contact-form" action="connexion.php" method="POST" role="form" class="form ">
            <!-- MESSAGE D'ERRER -->
                <div class="container ">
                    <?php 
                        if(!$SuccessConnexion){
                            echo'
                            <div class="row">
                                <div class="alert alert-danger col-md-6 container" role="alert">
                                    '.$connexionError.' 
                                </div>
                            </div>
                            ';
                        }
                    
                    ?>
                    
                    <div class="form-group">
                        <label>Login<span class="blue">*</span> </label>
                        <input type="text"   class="form-control " id="Prenom" name="Login">
                    </div>
                    <div class="form-group">
                        <label>Mot de passe<span class="blue"> *</span></label>
                        <input type="password" class="form-control " id="Psw" name="Psw">
                    </div>
                    <div class="form-group">
                        <button  type="submit" class="btn btn-success btn-lg">Connexion</button>
                        <div class="ForgotPsw"><a href="">j'ai oublie mon mot de passe</a></div>
                    </div>
                </div>
            </form>
        </div>
        </div>
</body>
</html>