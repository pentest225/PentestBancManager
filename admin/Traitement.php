<?php 
    require_once ('dataBase.php');
    $Tableau=array("Login" => "","Psw" => "","Psw_conf" => "","Num" => "","Image" => "","LoginError" => "","Psw_confError" => "","NumError" => "","IsSuccess" => TRUE,"ImagePath" => "" ,"ImageExtension" => "","PswError"=>"");
    if(!empty($_POST))
    {
        $Tableau['Login'] =VerifInfo($_POST['Login']);
        $Tableau['Psw']  = VerifInfo($_POST['Psw']);
        $Tableau['Psw_conf'] =VerifInfo($_POST['Psw_conf']);
        // $Tableau['Image'] = $_FILES['image']['name'];
        // $Tableau['ImagePath']="../images".basename($Tableau['Image']);
        // $Tableau['ImageExtension']=pathinfo($Tableau['Image'],PATHINFO_EXTENSION);
        $Tableau['IsSeccess']=TRUE;

        if(empty($Tableau['Login']))
        {
            $Tableau['LoginError']="Veillez saisir votre Nom";
            $Tableau['IsSeccess']=FALSE;
        }
        if(empty($Tableau['Psw']))
        {
            $Tableau['PswError']="Vous Avez oublier de saisir le Mod de Passe";
            $Tableau['IsSeccess']=FALSE;
        }
        if($Tableau['Psw'] != $Tableau['Psw_conf'] )  
        {
           $Tableau['Psw_confError']="Les Deux Mots de passe ne concordes Pas";
            $Tableau['IsSeccess']=FALSE ;
        }
        else{
            // PROTOTY DE HACHAGE DES MOTS DE PASSES
            $Tableau['Psw']=sha1($Tableau['Psw']);
        };
        // if(!empty($Image))
        // {
        //     // L'utilisateur veux charger une image verrifion cette Image #endregion
        //     if($Tableau['ImageExtension'] != "jpeg" || $Tableau['ImageExtension'] != "png" || $Tableau['ImageExtension'] != "gif")
        //     {
        //         $Tableau['ImageError']="Seul les fichiers Image Sons Autorise";
        //         $Tableau['IsSeccess']=FALSE;
        //     }
        //     if(file_exists($ImagePath))
        //     {
        //         $Tableau['ImageError']="Ce fichier Existe dejat ";
        //         $Tableau['IsSeccess']=FALSE;
        //     }
        //     if(!move_uploaded_file($_FILES['image']['tmp_name'],$ImagePath))
        //     {
        //         $Tableau['ImageError']="Problem lors du chagement Du fichier";
        //         $Tableau['IsSeccess']=FALSE;
        //     };
        // }
        // FIN DE LA VERIFICATION DE L'IMAGES 
        if($Tableau['IsSeccess'])
        {
            $db=DB::connect();
            $Insert=$db->prepare("INSERT INTO client (Nom ,Password ,Numero) VALUES (?,?,?) ");
            $Insert->execute(array($Tableau['Login'],$Tableau['Psw'],$Tableau['Num']));
            header("Location: ../profil.php");
        }
        
        echo json_encode($Tableau);   
     }
    function VerifInfo($info){
        $info=trim($info);
        $info=htmlspecialchars($info);
        $info=stripslashes($info);
        return $info;
    }


?>
